language: cpp

compiler:
  - gcc
  - clang

matrix:
  allow_failures:
    - compiler: clang

before_install:
  - travis_retry sudo add-apt-repository -y ppa:hvr/ghc
  - travis_retry sudo apt-get update
  - travis_retry sudo apt-get install libtokyocabinet-dev
  - travis_retry sudo apt-get install libboost-program-options-dev libboost-regex-dev libboost-serialization-dev libboost-thread-dev
  - travis_retry sudo apt-get install uuid-dev
  - travis_retry sudo apt-get install cutter-testing-framework
  - travis_retry sudo apt-get install cabal-install-1.18 ghc-7.6.3
  - travis_retry sudo apt-get install git
  - export PATH=$HOME/.cabal/bin:/opt/ghc/7.6.3/bin:/opt/cabal/1.18/bin:$PATH
  - git clone https://github.com/gree/flare-tests.git
  - cabal update
  - cabal install flare-tests/ --constraint='QuickCheck < 2.6'

before_script:
  - travis_retry ./autogen.sh
  - travis_retry ./configure

script: make && make test && make check & sudo make install & flare-tests
